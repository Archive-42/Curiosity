{
  "data": {
    "markdownRemark": {
      "html": "<h2>MongoDB Week 2 Part I:</h2>\n<h3>Creating Documents, the _id Field, Reading Documents</h3>\n<h4>Creating Documents in MongoDB</h4>\n<p>db.collection.insertOne({})\nCould include your own _id so that MongoDB does not create one for you.\nHowever, if you have two documents that are the same in every way except for _id, Mongo will interpret them as different documents</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">insertMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// insertMany has ordered: true by default.</span>\n<span class=\"token comment\">// This means that if there is an error inserting any item,</span>\n<span class=\"token comment\">// the function ends and only the documents inserted before the error are inserted</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\">// In many applications, we might want it to keep going after an error,</span>\n<span class=\"token comment\">// in which case we would change ordered to false.</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"ordered\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>You can create a document using update</p>\n<ul>\n<li>These are called 'upserts'</li>\n<li>This occurs when there are no documents that match the selector that is used to identify documents that need to be updated</li>\n</ul>\n<p>_id: All collections have a unique primary index on _id field by default. MongoDB creates _id with ObjectID value</p>\n<p>Each ObjectID is a 12-byte hex string</p>\n<ul>\n<li>First four bytes are a value representing the seconds since the Unix epoch</li>\n<li>Next 3 are machine address, Mac address for the machine on which the mongod server is running</li>\n<li>Next two bytes contain the process iD</li>\n<li>Last three are a counter to ensure all objectIDs are unique (even if they might meet the same circumstances for the other parts of the ObjectID</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">              Date     Mac   PID   Counter\nobjectID:    _ _ _ _ | _ _ | _ _ | _ _ _</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h4>Reading Documents</h4>\n<p><code class=\"language-text\">db.collection.find({ rated: &#39;PG-13&#39;})</code>\nFirst argument to find is known as the query document\nFields in query document are selectors that restrict the result set</p>\n<p>Selectors in the query document for find are implicitly &#x26;ed together</p>\n<p><code class=\"language-text\">db.collection.find({ &#39;tomato.meter&#39;: 100 })</code>\n^ to access nested documents, use dot notation - has to be in quotes</p>\n<h3>Exact Matches for Array Fields:</h3>\n<p><code class=\"language-text\">db.collection.find({ &quot;writers&quot;: [&quot;Ethan Coen&quot;, &quot;Joel Coen&quot;]})</code>\n^ order matters: This will search the collection for documents where Ethan Cohen and Joel Coen appear in the \"writers\" field in that order and where they are the only two elements of that array.</p>\n<h4>Matches to Any Element in Array:</h4>\n<p><code class=\"language-text\">db.collection.find({ &quot;actors&quot;: &quot;Jeff Bridges })</code>\nThis will return any document where \"Jeff Bridges\" is an element of the array \"actors\"</p>\n<ul>\n<li>Same syntax as structure for scalar values</li>\n<li>Don't need to enclose in square brackets unless doing an exact match on the entire array</li>\n</ul>\n<h3>Matches to a Specific Element of the Array:</h3>\n<p><code class=\"language-text\">db.collection.find({ &quot;actors.0&quot;: &quot;Jeff Bridges })</code>\nThis will return documents where \"Jeff Bridges\" is the first name listed in the actors array</p>\n<h3>Cursors:</h3>\n<p>Find method returns a cursor\nTo access documents, you need to iterate through a cursor\nIn the mongo shell, if we don't assign a return value from find using the var keyword, the cursor automatically is iterated up to 20 times to print the initial search results</p>\n<ul>\n<li>In general, mongoDB server returns query results in batches - batch size will not exceed maximum BSON document size - For most queries, first batch returns 101 documents or just enough to exceed 1mb - subsequent batches will be 4mb - It is possible to override batch size but outside scope of course\nIf we hit the end of our cursor, cursor.next() will perform a get more function\nIf you want to see how many left of cursor, etc....\nvar c = db.collection.find()\nvar doc = function() { return c.hasNext() ? c.next() : null }\nc.objLefInBatch()\nAnd then to iterate through the document, you would call doc()</li>\n</ul>\n<h3>Projection:</h3>\n<p>Handy way of reducing size of data returned for any one query</p>\n<ul>\n<li>By default, mongoDB returns all fields for all matching documents</li>\n<li>to limit the amount of data mongoDB sends to application, you can include projections\nProjections reduce the network overhead and processing requirements by limiting the fields returned in result documents\nProjections are supplied as the second argument of the find command</li>\n</ul>\n<p>Projection syntax allows you to explicitly include fields in documents returned - can also explicitly exclude fields</p>\n<ul>\n<li>if you want to exclude _id, expliclty state that in the projection document\n<code class=\"language-text\">db.collection.find({query document}, {projection document})</code></li>\n</ul>\n<h3>Comparison Operators:</h3>\n<ul>\n<li>Allow us to match on basis of a field's value relative to another value</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> runtime<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $gt<span class=\"token punctuation\">:</span> <span class=\"token number\">90</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// find documents where runtime is greater than 90</span>\n<span class=\"token comment\">// field: { value the field should have }</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> runtime<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $gte<span class=\"token punctuation\">:</span> <span class=\"token number\">90</span><span class=\"token punctuation\">,</span> $lte<span class=\"token punctuation\">:</span> <span class=\"token number\">120</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// find movies with runtimes between 90 and 120</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token string\">\"tomato.meter\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    $gte<span class=\"token punctuation\">:</span> <span class=\"token number\">95</span><span class=\"token punctuation\">,</span> runtime<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $gt<span class=\"token punctuation\">:</span> <span class=\"token number\">180</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        title<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> runtime<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> _id<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<p>^ find movies with a tomato rating of >= 95 &#x26; runtime of > 180, then project title, runtime, and not _id</p>\n<p>$eq has same semantics</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> rated<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $ne<span class=\"token punctuation\">:</span> <span class=\"token string\">\"UNRATED\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// all documents that don't have unrated ratings</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>^ will also return documents without a rated field (if there are any)\nRather than not having a 'null' in the field, mongoDB doesn't store that field at all</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> rated<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $<span class=\"token keyword\">in</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"G\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">PG</span>\"<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// all documents where rating is G or PG</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>value of $in has to be an array</p>\n<p>$nin is for matching none of the values specified in an array</p>\n<h3>Element Operators:</h3>\n<p>Considerations for the shape of a document: - Presence or absence/or data type of a field</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token string\">\"tomato.meter\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $exists<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// returns documents that have a tomato.meter rating</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token string\">\"tomato.meter\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $exists<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// returns documents that do not have a tomato.meter rating</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token string\">\"_id\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $type<span class=\"token punctuation\">:</span> <span class=\"token string\">\"string\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">//returns documents that have \"_id\" as a string rather than an ObjectId</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h3>Logical Operators:</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> $or <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"tomato.meter\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $gt<span class=\"token punctuation\">:</span> <span class=\"token number\">95</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"metacritic\"</span><span class=\"token punctuation\">:</span> $gt<span class=\"token punctuation\">:</span> <span class=\"token number\">88</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// takes array as argument, elements are criteria</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> $and <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">{</span> \"metacritic<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $ne<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"metacritic\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $exists<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// $and is necessary only in certain situations because of implicit &amp;</span>\n<span class=\"token comment\">// keys in JSON document have to be unique.</span>\n<span class=\"token comment\">// $and allows you to place multiple constraints on the same field</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3>Regex Operator:</h3>\n<p><code class=\"language-text\">db.collection.find({ &quot;awards.text&quot;: { $regex: /^Won\\s.*/ }})</code>\n^ means start at the beginning, Won means match with text that have Won as the beginning of the text, \\s means space, .* means followed by any sequence of other characters</p>\n<h3>Array Operators:</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> genres<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $all<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Comedy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Crime\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Drama\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// return documents that contain all three elements</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> countries<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $size<span class=\"token punctuation\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// documents where there was only one country listed</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> boxOffice<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $elemMatch<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    country<span class=\"token punctuation\">:</span> <span class=\"token string\">\"UK\"</span><span class=\"token punctuation\">,</span> revenue<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $gt<span class=\"token punctuation\">:</span> <span class=\"token number\">15</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// matches only when both country: UK and gt: 15 match in boxOffice</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li>all criteria be satisfied within a single element of an array field</li>\n<li>specify name of field we're matching against, use elemMatch operator, specify criteria against we want to match elements in the array</li>\n<li>Match only documents where all criteria are met within a single element of the array</li>\n</ul>\n<h3>Updating Documents:</h3>\n<h5>updateOne()</h5>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> filter<span class=\"token operator\">/</span>selector document <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    $<span class=\"token keyword\">set</span> <span class=\"token punctuation\">{</span> how we want to update the document<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<ul>\n<li>if there are multiple documnts with filter/selector, will update first one</li>\n</ul>\n<h5>Field update operators:</h5>\n<p><code class=\"language-text\">$set</code> takes a document as an argument and expects a document with a number of specified fields. Will update document matching the filter such that all key/value pairs are reflected in new version of document</p>\n<ul>\n<li>sets value of a field in a document\n$unset</li>\n<li>removes specified field from a document\n... etc.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">:</span> <span class=\"token string\">\"The Martian\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    $inc<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">\"tomato.reviews\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> \"tomato<span class=\"token punctuation\">.</span>userReviews<span class=\"token punctuation\">:</span> <span class=\"token number\">25</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// increments tomato reviews by 3 and userReviews by 25</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h4>Update Methods for Arrays</h4>\n<ul>\n<li>$addToSet - Update with new values only if value isn't contained in array</li>\n<li>$pop - Pull off first or last item of an array</li>\n<li>$pullAll - Removes all matching values from an array</li>\n<li>$pull - Remove all array elements that match a specified query</li>\n<li>$push - Add an item to the array</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">:</span> <span class=\"token string\">\"The Martian\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    $push<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> reviews<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $each <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">{</span> rating<span class=\"token punctuation\">:</span> <span class=\"token number\">4.5</span><span class=\"token punctuation\">,</span> date<span class=\"token punctuation\">:</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">,</span> etc<span class=\"token punctuation\">.</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<ul>\n<li>If you don't use $each, entire array in push will be added as single element in the array</li>\n<li>We would have an array that would have a single element that would be an array</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">updateOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> title<span class=\"token punctuation\">:</span> <span class=\"token string\">\"The Martian\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>$push<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    reviews<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> $each<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token punctuation\">{</span> keys<span class=\"token operator\">/</span>values <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> $position<span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> $slice<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// need to use $position to specify you want element at the front of the array</span>\n<span class=\"token comment\">// This is saying to add this field as the first element of the reviews field array</span>\n<span class=\"token comment\">// and that the array should only be 5 elements long</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Same principles apply to updateMany but it will make the same modification to all documents that match the filter.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">updateMany</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> rated<span class=\"token punctuation\">:</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> $unset<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> rated<span class=\"token punctuation\">:</span> <span class=\"token string\">''</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// removes the field 'rated' from docs where rated is null</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<h4>Upserts:</h4>\n<ul>\n<li>if no document is found matching our filter, insert\ndb.collection.updateOne( { \"imdb.id\" : detail.imdb.id }, { $set: detail }, { upsert: true })</li>\n<li>\n<p>update any document where imdb.id is equal to imdb.id in detail document</p>\n<ul>\n<li>in updating document, replaces it with essentially the exact same detail infomation</li>\n<li>guarantees not two copies of same thing with different _id</li>\n</ul>\n</li>\n</ul>\n<h4>replaceOne:</h4>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>collection<span class=\"token punctuation\">.</span><span class=\"token function\">replaceOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token string\">\"imdb\"</span><span class=\"token punctuation\">:</span> detail<span class=\"token punctuation\">.</span>imdb<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> detail<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// wholesale document document replacement</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>",
      "frontmatter": {
        "date": "2018-06-11",
        "title": "M101JS:",
        "chapter": null,
        "subtitle": "MongoDB for Node.JS Developers",
        "tags": ["MongoDB"],
        "path": "/M101JS-MongoDB-for-NodeJS-Developers"
      }
    }
  },
  "pageContext": {
    "isCreatedByStatefulCreatePages": false,
    "pathSlug": "/M101JS-MongoDB-for-NodeJS-Developers",
    "prev": {
      "frontmatter": {
        "path": "/CS9-Auth-I-Guided-Demo-II",
        "title": "CS9: Auth I",
        "tags": ["authentication", "CS9"],
        "subtitle": "Guided Demo II",
        "chapter": null
      }
    },
    "next": {
      "frontmatter": {
        "path": "/Authentication-Notes",
        "title": "Authentication Notes",
        "tags": ["authentication"],
        "subtitle": null,
        "chapter": null
      }
    }
  }
}
