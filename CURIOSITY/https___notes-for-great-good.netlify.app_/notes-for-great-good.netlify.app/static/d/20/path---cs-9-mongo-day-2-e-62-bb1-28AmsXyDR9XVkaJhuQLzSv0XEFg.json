{
  "data": {
    "markdownRemark": {
      "html": "<h4>Mongoose:</h4>\n<p>Library that wraps mongo DB native driver and provides cleaner API for us to connect to MongoDB and perform operations on our data.</p>\n<h4>Mongoose schema:</h4>\n<p>How we define the shape of our documents\nIf data has little or no structure, we probably just want to use the native driver rather than mongoose\nMongoose is when we have structured data</p>\n<p>mongoDB can have many databases</p>\n<ul>\n<li>\n<p>A JavaScript object is stored in mongoDB as a document</p>\n<ul>\n<li>A group of related documents is stored as a collection</li>\n<li>A group of collections is stored in a database</li>\n</ul>\n</li>\n</ul>\n<p>A mongoose schema compiles to mongoose model</p>\n<h5>Index:</h5>\n<p>Something you create to make searches go faster.</p>\n<ul>\n<li>\n<p>If there is no index, searches will be performed using a collection scan (will look at every record one at a time until it finds what it's looking for)</p>\n</li>\n<li>\n<p>Indexes get created automatically for primary key (__id) and when marked as unique in the schema</p>\n</li>\n<li>\n<p>You should add indexes on fields you know you will search a lot (though you should not put an index on every field because it takes up storage in the database).</p>\n</li>\n<li>\n<p>Fields marked as unique are given an index becasue the database has to search the collection at every insertion</p>\n</li>\n<li>\n<p>This is not done for fields that are only marked required (and not unique) because a required field does not have to check against the rest of the collection upon insertion.</p>\n</li>\n<li>\n<p><code class=\"language-text\">index: true</code> is the way to mark a field as having an index while not giving it a unique property.</p>\n</li>\n</ul>\n<p>It is possible to make a compound field with an index to speed up querying if you know queries with a given combination of fields will be common:\nExample: bearSchema.index({ species: 1, latinName: -1 })\n1 - ascending, -1 descending</p>\n<h5>MongoDB</h5>\n<p>When designing mongoDB databases, it's important to think about how the user will use the data and customize the database to be specific to the user.</p>\n<p>SQL is client/application-agnostic.</p>\n<p>Adding to Schemas\n<code class=\"language-text\">options object = { strict: true }</code>\nThis is the default that mongoose gives to schemas. If you want to be able to add things not on the schema, you should specify strict: false\nMongoose will then validate things that are set on the schema and accept the rest of what's been passed in through req.body</p>\n<h4>Model.discriminators:</h4>\n<p>Introduces inheritance\nIs more detailed and not covered in this course\nSchema inheritance\nBase schema and then other schemas that add to it\nExample: Animal Schema and then a Dog and Cat Schema\nMultiple models with overlapping schemas on top of the same underlying MongoDB collection\nShould use caution because whenever you bring inheritance into a system, you're making some tight coupling</p>\n<h5>Will DBA be mad at you using strict: false?</h5>\n<p>If you have a DBA (database administrator), obey them - they will be in charge of modeling, etc., so you don't have to worry about strict: false, etc.</p>\n<p>Clarification:\nCan still write routes the way we did in previous lessons:\n<code class=\"language-text\">router.get(&#39;/&#39;, (req, res) =&gt; {...})</code></p>\n<h4>Note on delete:</h4>\n<p>Normally on delete, we would not return an object, we would have a tool for no content (204) - Nothing returns except a status code saying that it was successful\nNeed to do .end() or return() or it will get stuck if you only send status</p>\n<h4>Delete Method</h4>\n<p>findByIdAndDelete is a mongoose method\nIn MongoDB, you would have to find and then delete</p>\n<h4>Cast Error</h4>\n<p>If you give an ID as a string, Mongo will try to convert it to an ObjectId\nIf it can't : Cast error</p>\n<p>When you call Json or end, it will end the request and send the response right away, but apparently status will not stop the request. Request goes through, but API doesn't return back to the client saying it's done.</p>\n<h4>Order not important in if/else:</h4>\n<p>That is, works the same if you have if <code class=\"language-text\">(true) {...} else { ... }</code> and if you have <code class=\"language-text\">if (false) {...} else {....}</code></p>\n<h5>POST REQUEST EXAMPLE</h5>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">router<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>'<span class=\"token operator\">/</span><span class=\"token punctuation\">:</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">;</span>\n    Bear<span class=\"token punctuation\">.</span><span class=\"token function\">findByIdAndUpdate</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">bear</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bear<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>bear<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> msg<span class=\"token punctuation\">:</span> <span class=\"token string\">'Bear not found'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Default is to return original object.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> update <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">new</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\">Bear<span class=\"token punctuation\">.</span><span class=\"token function\">findByIdAndUpdate</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">bear</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bear<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>bear<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">404</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> msg<span class=\"token punctuation\">:</span> <span class=\"token string\">'Bear not found'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Built-in validators always run:\nExample: unique</p>\n<h6>You should in theory do validation at all three levels:</h6>\n<ul>\n<li>Client so you don't hit the API with invalid data</li>\n<li>\n<p>If client sends you back data, validate at the API (router, interface with the client)</p>\n<ul>\n<li>Doesn't have to be inside the route. Might call a function to validate</li>\n</ul>\n</li>\n<li>Data validation when you're using Mongoose, you can use custom validators on the schema so Mongoose does the validation for you</li>\n</ul>",
      "frontmatter": {
        "date": "2018-06-07",
        "title": "CS9 Mongo Day 2",
        "chapter": null,
        "subtitle": null,
        "tags": ["MongoDB", "CS9"],
        "path": "/CS9-Mongo-Day-2"
      }
    }
  },
  "pageContext": {
    "isCreatedByStatefulCreatePages": false,
    "pathSlug": "/CS9-Mongo-Day-2",
    "prev": {
      "frontmatter": {
        "path": "/CS9-Mongo-Day-1",
        "title": "CS9 Mongo Day 1",
        "tags": ["MongoDB", "CS9"],
        "subtitle": null,
        "chapter": null
      }
    },
    "next": {
      "frontmatter": {
        "path": "/CS9-Mongo-Day-3",
        "title": "CS9 Mongo Day 3",
        "tags": ["MongoDB", "CS9"],
        "subtitle": null,
        "chapter": null
      }
    }
  }
}
